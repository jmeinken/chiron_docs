<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>2. Set Up the Data Dictionary &mdash; Chiron 2.1.3 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="3. Load data into MongoDB" href="loading_data.html" />
    <link rel="prev" title="1. Install Chiron" href="installing.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> Chiron
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../system_overview.html">System Overview</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../workflow.html">Site Deployment Workflow</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="installing.html">1. Install Chiron</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">2. Set Up the Data Dictionary</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#data-dictionary-overview">Data Dictionary Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="#autocreate-the-data-dictionary">Autocreate the Data Dictionary</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#step-1-create-a-model-tree-file">Step 1: Create a model tree file</a></li>
<li class="toctree-l4"><a class="reference internal" href="#step-2-define-how-the-models-will-map-to-chiron-collections">Step 2: Define how the models will map to Chiron collections</a></li>
<li class="toctree-l4"><a class="reference internal" href="#step-3-define-how-the-models-will-map-to-chiron-categories">Step 3: Define how the models will map to Chiron categories</a></li>
<li class="toctree-l4"><a class="reference internal" href="#step-4-tell-chiron-where-your-modeltree-text-files-are">Step 4: Tell Chiron where your modeltree text files are</a></li>
<li class="toctree-l4"><a class="reference internal" href="#step-5-cleanup-dd">Step 5: Cleanup DD</a></li>
<li class="toctree-l4"><a class="reference internal" href="#rerunning-autocreate-after-changes">Rerunning Autocreate After Changes</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#manually-create-edit-the-data-dictionary">Manually Create/Edit the Data Dictionary</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="loading_data.html">3. Load data into MongoDB</a></li>
<li class="toctree-l2"><a class="reference internal" href="deploying_to_production.html">4. Deploy to Production</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../configuration.html">Chiron Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api.html">Chiron API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../version_changelog.html">Version Changelog</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Chiron</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../workflow.html">Site Deployment Workflow</a> &raquo;</li>
      <li>2. Set Up the Data Dictionary</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/topics/workflow/setting_up_data_dictionary.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section class="tex2jax_ignore mathjax_ignore" id="set-up-the-data-dictionary">
<h1>2. Set Up the Data Dictionary<a class="headerlink" href="#set-up-the-data-dictionary" title="Permalink to this headline"></a></h1>
<section id="data-dictionary-overview">
<h2>Data Dictionary Overview<a class="headerlink" href="#data-dictionary-overview" title="Permalink to this headline"></a></h2>
<p><strong>Collections</strong></p>
<p>Collections in the data dictionary represent literal MongoDB collections. If you’re not familiar with MongoDB, you can think of a collection as a table.</p>
<p>Every data dictionary will have one subject collection (flagged with <code class="docutils literal notranslate"><span class="pre">is_root_collection=True</span></code>) to store data that is 1:1 with the subject. Then you can have any number of sub-collections for data that is 1:many with the subject.</p>
<p>The only relationships are between your subject collection and sub-collections. Sub-collections cannot have other sub-collections, and you cannot have relationships between sub-collections (though this might be added in the future).</p>
<p><strong>Concepts</strong></p>
<p>Each collection can have any number of concepts. The subject collection could have concepts like birthdate and gender. A biospecimen collection could have concepts like collection date and sample amount.</p>
<p><strong>SourceCollections</strong></p>
<p>A SourceCollection is a dataset to load into Chiron. It can be anything that can be iterated to get records that correspond to the collection it’s being loaded into.</p>
<p>For example, a SubjectDemographics table in a database could be a SourceCollection for the Subject collection. A CSV file with one row per patient medication could be a SourceCollection for a Medication collection.</p>
<p>Chiron manages the ETL process from your SourceCollections into MongoDB. There’s built-in support for data coming from a database through the Django ORM or from CSV files. If you have data coming from other types of sources, you can write your own SourceCollection processor class to enable Chiron to consume it.</p>
<p><strong>Categories</strong></p>
<p>Categories define a hierarchical structure for users to browse concepts. They have no effect on queries or how the data is stored in MongoDB.</p>
</section>
<section id="autocreate-the-data-dictionary">
<h2>Autocreate the Data Dictionary<a class="headerlink" href="#autocreate-the-data-dictionary" title="Permalink to this headline"></a></h2>
<p>If the data you’re using is coming from the Django ORM, you can autocreate a data dictionary and then edit as needed from there. For any other data source, you have to create the data dictionary from scratch.</p>
<section id="step-1-create-a-model-tree-file">
<h3>Step 1: Create a model tree file<a class="headerlink" href="#step-1-create-a-model-tree-file" title="Permalink to this headline"></a></h3>
<p>You need to create a text file that shows how your Django model relationships are set up. This file can go anywhere, but a good place to store it is <code class="docutils literal notranslate"><span class="pre">[YOUR</span> <span class="pre">PROJECT</span> <span class="pre">DIR]/chiron_config/autocreate/modeltree_[dataset</span> <span class="pre">name].txt</span></code>.</p>
<p>Start with a single model (if you have a subject model, start with that). Then list all models with a direct relationship to the first model with a single hyphen. The type of relationship (1:1, 1:many, many:1, many:many) doesn’t matter. Then under each of those list any relationships with a double hyphen. Continue until all your models are listed. This is your model tree.</p>
<p>You must specify the Django app for at least the first model as <code class="docutils literal notranslate"><span class="pre">my_app.my_model</span></code>. All children will be assumed to be in the same app as their parent. For any models where that is not true, specify the Django app.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Lines starting with pound sign are ignored.</span>
<span class="c1"># In this example, the Subject model has a 1:1 relationship with Demographics, a 1:many relationship with biospecimen, and a many:many relationship with medications.</span>
<span class="c1"># Then the Demographics model has a RaceLookup table allowing a subject to have more than one race.</span>
<span class="c1"># The Biospecimen model has a many:1 relationsip with FreezerLocation and then the FreezerLocation has a many:1 relationship with BuildingLocation.</span>

<span class="n">my_django_app</span><span class="o">.</span><span class="n">Subject</span>
<span class="o">-</span><span class="n">Demographics</span>
<span class="o">--</span><span class="n">RaceLookup</span>
<span class="o">-</span><span class="n">Biospecimen</span>
<span class="o">--</span><span class="n">FreezerLocation</span>
<span class="o">---</span><span class="n">BuildingLocation</span>
<span class="o">-</span><span class="n">Medications</span>

</pre></div>
</div>
</section>
<section id="step-2-define-how-the-models-will-map-to-chiron-collections">
<h3>Step 2: Define how the models will map to Chiron collections<a class="headerlink" href="#step-2-define-how-the-models-will-map-to-chiron-collections" title="Permalink to this headline"></a></h3>
<p>You can use asterisks to mark models you want converted into collections. Each model marked with an asterisk will get its own collection. Models not marked with an asterisk will go into the closest parent collection.</p>
<p>Use a double asterisk to add something to the subject collection.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Subject, Demographics and RaceLookup fields will all be added to the Subject collection.</span>
<span class="c1"># Biospecimen, FreezerLocation, and BuildingLocation fields will all go into a new collection called Biospecimen.</span>
<span class="c1"># Medication fields will go into a new collection called Medications.</span>

<span class="n">my_django_app</span><span class="o">.</span><span class="n">Subject</span><span class="o">**</span>
<span class="o">-</span><span class="n">Demographics</span>
<span class="o">--</span><span class="n">RaceLookup</span>
<span class="o">-</span><span class="n">Biospecimen</span><span class="o">*</span>
<span class="o">--</span><span class="n">FreezerLocation</span>
<span class="o">---</span><span class="n">BuildingLocation</span>
<span class="o">-</span><span class="n">Medications</span><span class="o">*</span>

</pre></div>
</div>
<p><strong>Rarer situations</strong></p>
<p>Sometimes if the source data is modeled poorly, you might want to associate a model with the collection above the parent collection. This often comes up with REDCap longitudinal projects. Use a carat symbol.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Demographics is 1:1 with Subject but is associated with SurveyEvents in the source database.</span>
<span class="c1"># In this example, Demographics fields will be added to the Subject collection. WeeklyReport fields will be added to the SurveyEvents collection.</span>

<span class="n">my_django_app</span><span class="o">.</span><span class="n">Subject</span><span class="o">**</span>
<span class="o">-</span><span class="n">SurveyEvents</span><span class="o">*</span>
<span class="o">--</span><span class="n">Demographics</span><span class="o">^</span>
<span class="o">--</span><span class="n">WeeklyReport</span>
</pre></div>
</div>
</section>
<section id="step-3-define-how-the-models-will-map-to-chiron-categories">
<h3>Step 3: Define how the models will map to Chiron categories<a class="headerlink" href="#step-3-define-how-the-models-will-map-to-chiron-categories" title="Permalink to this headline"></a></h3>
<p>By default, a new category will be created for each model. If you don’t want to create a category for a model, put an <code class="docutils literal notranslate"><span class="pre">&#64;</span></code> mark next to it. The fields will instead go into the nearest parent.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Subject and Demographics categories will be created. RaceLookup fields will go into the Demographics category.</span>
<span class="c1"># A Biospecimen category will be created and all Biospecimen, FreezerLocation, and BuildingLocation fields will go into it.</span>
<span class="c1"># A medications category will be created.</span>

<span class="n">my_django_app</span><span class="o">.</span><span class="n">Subject</span><span class="o">**</span>
<span class="o">-</span><span class="n">Demographics</span>
<span class="o">--</span><span class="n">RaceLookup</span><span class="o">@</span>
<span class="o">-</span><span class="n">Biospecimen</span><span class="o">*</span>
<span class="o">--</span><span class="n">FreezerLocation</span><span class="o">@</span>
<span class="o">---</span><span class="n">BuildingLocation</span><span class="o">@</span>
<span class="o">-</span><span class="n">Medications</span><span class="o">*</span>

</pre></div>
</div>
</section>
<section id="step-4-tell-chiron-where-your-modeltree-text-files-are">
<h3>Step 4: Tell Chiron where your modeltree text files are<a class="headerlink" href="#step-4-tell-chiron-where-your-modeltree-text-files-are" title="Permalink to this headline"></a></h3>
<p>The autocreate_dd_config list tells Chiron where all your modeltree text files are. By default, Chiron will look for this list in chiron_config/autocreate/autocreate.py.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># file location chiron_config/autocreate/autocreate.py</span>

<span class="n">autocreate_dd_config</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="s1">&#39;source_id&#39;</span> <span class="p">:</span> <span class="s1">&#39;myapp&#39;</span><span class="p">,</span>              <span class="c1"># this can be any unique ID you want</span>
        <span class="s1">&#39;modeltree_path&#39;</span> <span class="p">:</span> <span class="s1">&#39;chiron_config/autocreate/modeltree_myapp.txt&#39;</span><span class="p">,</span>
    <span class="p">},</span>
<span class="p">]</span>
</pre></div>
</div>
<p>Now you can run the autocreate management command. If your autocreate_dd_config file isn’t in the standard location, you can specify the Python module in Django settings using CHIRON_AUTOCREATE_DD_MODULE_PATH, or you can pass it as an argument using –module.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">manage</span><span class="o">.</span><span class="n">py</span> <span class="n">chiron_autocreate_dd</span>
</pre></div>
</div>
</section>
<section id="step-5-cleanup-dd">
<h3>Step 5: Cleanup DD<a class="headerlink" href="#step-5-cleanup-dd" title="Permalink to this headline"></a></h3>
</section>
<section id="rerunning-autocreate-after-changes">
<h3>Rerunning Autocreate After Changes<a class="headerlink" href="#rerunning-autocreate-after-changes" title="Permalink to this headline"></a></h3>
<p>There is a dedicated model AutoImportedField to keep track of all fields that have been loaded through autocreate. Any fields that have been imported are tracked in this model and will not be imported again, even if the associated Concepts have been modified or deleted. So it is safe to rerun chiron_autocreate_dd after adding new modeltrees, models, or fields.</p>
<p>If you actually want to reload previously loaded concepts (for example, if you deleted something by accident), you can remove the fields you wish to re-import from AutoImportedField, then run chiron_autocreate_dd again.</p>
</section>
</section>
<section id="manually-create-edit-the-data-dictionary">
<h2>Manually Create/Edit the Data Dictionary<a class="headerlink" href="#manually-create-edit-the-data-dictionary" title="Permalink to this headline"></a></h2>
<p>See the full data dictionary for all configuration options - <a class="reference internal" href="../configuration/data_dict_models.html"><span class="doc">Data Dictionary</span></a></p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="installing.html" class="btn btn-neutral float-left" title="1. Install Chiron" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="loading_data.html" class="btn btn-neutral float-right" title="3. Load data into MongoDB" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020, UC Center for Health Informatics, Cincinnati Children&#39;s Biomedical Informatics.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>